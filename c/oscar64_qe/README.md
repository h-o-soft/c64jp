# QE - Oscar64版テキストエディタ

| [English](README-en.md) | [日本語](README.md) |
|---------------------------|------------------------|

Oscar64コンパイラでビルドされたCommodore 64用日本語対応テキストエディタです。

## 概要

このエディタは、David GivenによるCP/M-65プロジェクトの[qe](https://github.com/davidgiven/cpm65/blob/master/apps/qe.c)をOscar64コンパイラ向けに移植したものです。llvm-mos版（`c/src/qe/`）と同等の機能を提供します。

### 主な機能

- **日本語表示対応**: Shift-JIS文字コードによる全角文字の表示
- **ビットマップモード**: jtxtライブラリによる高品質な日本語表示
- **かな漢字変換**: IMEによるローマ字入力からの日本語変換
- **Viライクなキーバインディング**: 効率的なテキスト編集操作
- **ファイルI/O**: C64 KERNALルーチンによるファイルの読み書き

## ファイル構成

```
oscar64_qe/
├── Makefile           # ビルド設定
├── include/
│   └── screen.h       # 画面制御ヘッダ
└── src/
    ├── qe.c           # メインエディタ
    └── screen.c       # 画面制御
```

jtxtライブラリおよびIMEは `../oscar64_lib/` から参照しています。

## ビルド方法

```bash
# このディレクトリでビルド
make

# または、ルートディレクトリから
cd ../..
make oscar-qe-build
```

## 実行方法

MagicDeskカートリッジが必要です。ルートディレクトリから実行：

```bash
cd ../..
make oscar-qe-run
```

## 基本操作

### モード

- **ノーマルモード**（起動時）: カーソル移動、削除、コマンド実行
- **インサートモード**: 文字入力
- **リプレースモード**: 文字上書き

### ノーマルモードキー操作

| キー | 動作 |
|------|------|
| `i` | インサートモード開始 |
| `A` | 行末からインサートモード開始 |
| `o` / `O` | 下/上に新しい行を挿入 |
| `h` `j` `k` `l` | カーソル移動（左・下・上・右） |
| `^` `$` | 行頭・行末に移動 |
| `x` | 1文字削除 |
| `dd` | 行削除 |
| `J` | 次の行を連結 |
| `R` | リプレースモード |
| `:` | コマンドモード |

### コマンドモード

| コマンド | 動作 |
|----------|------|
| `:w` | ファイル保存 |
| `:q` | 終了 |
| `:q!` | 強制終了 |
| `:e filename` | ファイルを開く |
| `:n` | 新規ファイル |

### IME操作（インサートモード中）

| キー | 動作 |
|------|------|
| `Commodore + Space` | IME有効化 |
| `Space` | 変換/次候補 |
| `Enter` | 確定 |
| `ESC` | キャンセル |
| `Ctrl+K` | ひらがな/カタカナ切り替え |

## 必要要件

- Oscar64コンパイラ
- MagicDeskカートリッジ（`c64jpkanji.crt`）
- VICEエミュレータまたは実機

## 制限事項

- 最大編集可能サイズ: 約11KB
- Undo/Redo機能なし
- 検索・置換機能なし

## 関連プロジェクト

- `../oscar64_lib/` - 共有ライブラリ（jtxt, IME, c64uネットワーク）
- `../oscar64/` - 基本サンプル
- `../oscar64_crt/` - EasyFlash版
- `../oscar64_term/` - ターミナル（Ultimate II+ネットワーク）
- `../../src/qe/` - llvm-mos版

## ライセンス

元のqeエディタ（© 2019 David Given）を改造したもの。2条項BSDライセンス。

詳細は `c/src/qe/README.md` を参照してください。
