# Prog8 Programs

| [English](README-en.md) | [日本語](README.md) |
|---------------------------|------------------------|

This directory contains Prog8 programs for the C64 Japanese ROM project.

## Libraries

### Core Libraries
- **[jtxt.p8](src/jtxt.md)** - Japanese text display library
  - Supports both text mode and bitmap mode
  - Shift-JIS character code support
  - Font data loading from MagicDesk ROM cartridge
  - High-speed rendering via PCG (Programmable Character Generator)

- **[ime.p8](src/ime.md)** - Kana-Kanji conversion library  
  - Single-clause conversion from romanized input → hiragana → kanji
  - Dictionary-based conversion using ROM cartridge dictionary
  - Verb inflection support (okuri-ari conversion)
  - Learning function (candidate selection frequency recording)

### Communication Libraries
- **[swiftlink.p8](src/swiftlink.md)** - SwiftLink RS-232 communication library
  - 6551 ACIA control
  - NMI interrupt-driven
  - 256-byte ring buffer
  - Multiple baud rate support

## Sample Programs

### Basic Samples
- **hello.p8** - Basic Japanese display demo
  - Hello world program demonstrating basic usage of jtxt.p8
  - Displays "こんにちはコモドール!" (Hello Commodore!)

- **hello_bitmap.p8** - Japanese display demo in bitmap mode
  - Japanese text display in bitmap mode
  - Scrolling functionality demonstration

- **hello_resource.p8** - String resource loading demo
  - Loads and displays Japanese text from string resources in CRT file

### IME Samples
- **ime_test.p8** - Kana-Kanji conversion test program
  - Interactive testing of romanized input to Japanese conversion
  - Single-clause conversion, candidate selection, and learning function demo
  - Implementation example in bitmap mode

### Communication Samples
- **modem_test.p8** - SwiftLink communication test program  
  - RS-232 communication send/receive testing
  - Japanese character send/receive demo
  - Compatible with VICE emulator RS-232 emulation

## Build Instructions

### Basic Build
```bash
# Build default (hello.p8)
make

# Build specific program
make TARGET=ime_test

# Build and run
make run
make TARGET=ime_test run
```

### Run with Cartridge
```bash
# Run with basic cartridge
make run

# Run with string resource cartridge  
make run-strings

# Run without cartridge (for debugging)
make run-no-crt
```

### Special Run Modes
```bash
# Run IME test (alias)
make ime

# Run modem test (with RS-232 emulation enabled)
make modem
```

## Requirements

- **Prog8 Compiler** v11.4.1 or later
- **VICE Emulator** (recommended: x64sc)
- **MagicDesk format CRT file** (automatically generated by make command)

## Programming Notes

### Memory Usage
- `$0340-$03FF`: String buffer (used by jtxt.p8)
- `$3000-$3800`: PCG character RAM (in text mode)
- `$6000-$7FFF`: Bitmap data (in bitmap mode)

### Character Encoding
- Japanese strings use Shift-JIS encoding
- ASCII characters use `iso:` prefix

### Bank Switching
- MagicDesk bank switching uses `$DE00`
- Font data: Banks 0-9
- Dictionary data: Banks 10-35
- String resources: Banks 36+

## Troubleshooting

### Character Corruption
- Verify CRT file is loaded correctly
- Check character range settings in jtxt.init()

### IME Not Working
- Verify using CRT with dictionary file
- Check that ime.init() is called

### Communication Not Working
- Check SwiftLink I/O address settings (default: $DF00)
- Verify VICE RS-232 settings