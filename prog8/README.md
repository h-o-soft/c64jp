# Prog8プログラム

| [English](README-en.md) | [日本語](README.md) |
|---------------------------|------------------------|

このディレクトリには、C64日本語ROMプロジェクトのProg8プログラムが含まれています。

## ライブラリ

### 基本ライブラリ
- **[jtxt.p8](src/jtxt.md)** - 日本語テキスト表示ライブラリ
  - テキストモード/ビットマップモード両対応
  - Shift-JIS文字コード対応
  - MagicDesk ROMカートリッジからのフォントデータ読み込み
  - PCG（Programmable Character Generator）による高速描画

- **[ime.p8](src/ime.md)** - かな漢字変換ライブラリ  
  - ローマ字→ひらがな→漢字の単文節変換
  - ROMカートリッジにある辞書を使用した変換
  - 動詞活用対応（送りあり変換）
  - 学習機能（候補選択頻度記録）

### 通信ライブラリ
- **[swiftlink.p8](src/swiftlink.md)** - SwiftLink RS-232通信ライブラリ
  - 6551 ACIA制御
  - NMI割り込み駆動
  - 256バイトリングバッファ
  - 各種ボーレート対応

## サンプルプログラム

### 基本サンプル
- **hello.p8** - 基本的な日本語表示デモ
  - jtxt.p8の基本的な使い方を示すハローワールドプログラム
  - 「こんにちはコモドール！」を表示

- **hello_bitmap.p8** - ビットマップモードでの日本語表示デモ
  - ビットマップモードでの日本語表示
  - スクロール機能のデモンストレーション

- **hello_resource.p8** - 文字列リソース読み込みデモ
  - CRTファイル内の文字列リソースから日本語テキストを読み込んで表示

### IMEサンプル
- **ime_test.p8** - かな漢字変換テストプログラム
  - ローマ字入力から日本語への変換をインタラクティブにテスト
  - 単文節変換、候補選択、学習機能のデモ
  - ビットマップモードでの実装例

### 通信サンプル
- **modem_test.p8** - SwiftLink通信テストプログラム  
  - RS-232通信の送受信テスト
  - 日本語文字の送受信デモ
  - VICEエミュレータのRS-232エミュレーション対応

## ビルド方法

### 基本的なビルド
```bash
# デフォルト（hello.p8）のビルド
make

# 特定のプログラムをビルド
make TARGET=ime_test

# ビルドして実行
make run
make TARGET=ime_test run
```

### カートリッジ付きでの実行
```bash
# 基本カートリッジで実行
make run

# 文字列リソース付きカートリッジで実行  
make run-strings

# カートリッジなしで実行（デバッグ用）
make run-no-crt
```

### 特殊な実行モード
```bash
# IMEテストの実行（エイリアス）
make ime

# モデムテストの実行（RS-232エミュレーション有効）
make modem
```

## 必要な環境

- **Prog8コンパイラ** v11.4.1以降
- **VICEエミュレータ** (推奨: x64sc)
- **MagicDesk形式CRTファイル** (makeコマンドで自動生成)

## プログラム作成時の注意

### メモリ使用
- `$0340-$03FF`: 文字列バッファ（jtxt.p8が使用）
- `$3000-$3800`: PCG用キャラクタRAM（テキストモード時）
- `$6000-$7FFF`: ビットマップデータ（ビットマップモード時）

### 文字コード
- 日本語文字列はShift-JISエンコーディングを使用
- ASCII文字は`iso:`プレフィックスを使用

### バンク切り替え
- MagicDeskのバンク切り替えは`$DE00`を使用
- フォントデータ: Bank 0-9
- 辞書データ: Bank 10-35
- 文字列リソース: Bank 36以降

## トラブルシューティング

### 文字化けする場合
- CRTファイルが正しくロードされているか確認
- jtxt.init()の文字範囲設定を確認

### IMEが動作しない場合
- 辞書ファイルが含まれたCRTを使用しているか確認
- ime.init()が呼ばれているか確認

### 通信が動作しない場合
- SwiftLinkのI/Oアドレス設定を確認（デフォルト: $DF00）
- VICEのRS-232設定を確認